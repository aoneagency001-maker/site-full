# ğŸ“± ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² Telegram

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ñ‰ĞµĞµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ](#Ğ¾Ğ±Ñ‰ĞµĞµ-Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ)
2. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
3. [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹](#ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹-Ğ¸-Ñ„Ğ°Ğ¹Ğ»Ñ‹)
4. [Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾ÑĞ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸](#Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾ÑĞ²ÑĞ·Ğ¸-Ğ¼ĞµĞ¶Ğ´Ñƒ-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸)
5. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸](#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸-Ğ¸-Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
6. [Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹](#Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°-Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹)
7. [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ](#Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°-Ğ¸-ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
8. [Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹](#Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚-ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹)
9. [ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](#Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹-Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
10. [Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°](#Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°-Ğ¸-Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°)

---

## ğŸ¯ ĞĞ±Ñ‰ĞµĞµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ĞµĞ¹ ÑĞ°Ğ¹Ñ‚Ğ° Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² Telegram Ğ¿Ñ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğ¸. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ğµ: ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾, Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° (UTM-Ğ¼ĞµÑ‚ĞºĞ¸), IP-Ğ°Ğ´Ñ€ĞµÑ, Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ, Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ.

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:

- âœ… **ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ĞµĞ¹** (Ğ½Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ñ…)
- âœ… **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²** (Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ñ… Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼)
- âœ… **Ğ¡Ğ±Ğ¾Ñ€ UTM-Ğ¼ĞµÑ‚Ğ¾Ğº** Ğ´Ğ»Ñ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ†Ğ¸Ğ¸ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
- âœ… **ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°** (Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ/Ğ¿Ğ»Ğ°Ğ½ÑˆĞµÑ‚/Ğ´ĞµÑĞºÑ‚Ğ¾Ğ¿)
- âœ… **Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ IP** (Ğ³Ğ¾Ñ€Ğ¾Ğ´, ÑÑ‚Ñ€Ğ°Ğ½Ğ°)
- âœ… **Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼Ğ¸** (ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°, ĞºĞ²Ğ¸Ğ·)
- âœ… **Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** Ğ² Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ JSON Ñ„Ğ°Ğ¹Ğ»
- âœ… **Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¾Ğ¹** (Yandex.Metrika, Google Analytics)

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ¡ĞšĞĞ¯ Ğ§ĞĞ¡Ğ¢Ğ¬                         â”‚
â”‚  (Browser - React Component)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ POST /api/track-visitor
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ğ¡Ğ•Ğ Ğ’Ğ•Ğ ĞĞĞ¯ Ğ§ĞĞ¡Ğ¢Ğ¬ (Next.js API)                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /api/track-visitor/route.ts                      â”‚    â”‚
â”‚  â”‚  - Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ (Ğ±Ğ¾Ñ‚Ñ‹, IP)                           â”‚    â”‚
â”‚  â”‚  - ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ User-Agent                             â”‚    â”‚
â”‚  â”‚  - Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ IP                               â”‚    â”‚
â”‚  â”‚  - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² data/visitors.json                â”‚    â”‚
â”‚  â”‚  - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Telegram                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                â”‚
â”‚                            â”‚ sendToTelegram()               â”‚
â”‚                            â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  lib/telegram.ts                                   â”‚    â”‚
â”‚  â”‚  - sendToTelegram()                                â”‚    â”‚
â”‚  â”‚  - formatContactMessage()                          â”‚    â”‚
â”‚  â”‚  - formatQuizMessage()                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                â”‚
â”‚                            â”‚ HTTP POST                      â”‚
â”‚                            â–¼                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TELEGRAM BOT API                               â”‚
â”‚  https://api.telegram.org/bot{TOKEN}/sendMessage            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TELEGRAM Ğ§ĞĞ¢                                    â”‚
â”‚  Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ÑÑ…, Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ…, ĞºĞ²Ğ¸Ğ·Ğ°Ñ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹

### 1. **ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚**

**Ğ¤Ğ°Ğ¹Ğ»:** `components/analytics/visitor-tracker.tsx`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** React-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ğµ.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ `sessionId` Ğ¸Ğ· `sessionStorage`
- Ğ¡Ğ±Ğ¾Ñ€ UTM-Ğ¼ĞµÑ‚Ğ¾Ğº Ğ¸Ğ· URL
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ landing page
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ Ñ‡ĞµÑ€ĞµĞ· `fetch()`
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Yandex.Metrika Ğ¸ Google Analytics
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞºĞ¾Ğ² Ğ¸ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¹

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸ ĞºĞ¾Ğ´Ğ°:**

```typescript
// Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ session ID
let sessionId = sessionStorage.getItem("session_id");
if (!sessionId) {
  sessionId = uuidv4();
  sessionStorage.setItem("session_id", sessionId);
}

// Ğ¡Ğ±Ğ¾Ñ€ UTM-Ğ¼ĞµÑ‚Ğ¾Ğº
const urlParams = new URLSearchParams(window.location.search);
const utmData = {
  utmSource: urlParams.get("utm_source"),
  utmMedium: urlParams.get("utm_medium"),
  utmCampaign: urlParams.get("utm_campaign"),
  utmTerm: urlParams.get("utm_term"),
  utmContent: urlParams.get("utm_content"),
};

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
fetch("/api/track-visitor", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(visitorData),
})
```

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:**

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ² ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¼ layout:

```typescript
// app/[locale]/layout.tsx
import { VisitorTracker } from "@/components/analytics/visitor-tracker";

export default async function LocaleLayout({ children, params }) {
  return (
    <body>
      <VisitorTracker />
      {children}
    </body>
  );
}
```

---

### 2. **API Route Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ĞµĞ¹**

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/track-visitor/route.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ğ¹ endpoint, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ğµ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**

#### 2.1. **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²**

```typescript
const BOT_USER_AGENTS = [
  "googlebot", "bingbot", "yandexbot", "baiduspider",
  "facebookexternalhit", "twitterbot", "linkedinbot",
  "slackbot", "discordbot", "whatsapp", "telegrambot",
  "crawl", "spider", "bot", "headless", "phantom",
  "selenium", "puppeteer", "playwright", "webdriver",
  "curl", "wget", "python-requests", "go-http-client", "java/"
];

function isBot(userAgent: string): boolean {
  if (!userAgent) return true;
  const ua = userAgent.toLowerCase();
  const botPatterns = BOT_USER_AGENTS.filter((bot) => bot !== "http");
  return botPatterns.some((bot) => ua.includes(bot));
}
```

#### 2.2. **Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ IP**

```typescript
async function getGeoLocation(ip: string) {
  try {
    const response = await fetch(`http://ip-api.com/json/${ip}?lang=ru`);
    const data = await response.json();
    if (data.status === "success") {
      return {
        country: data.country || "Unknown",
        city: data.city || "Unknown",
        region: data.regionName || "Unknown",
        timezone: data.timezone || "Unknown",
        isp: data.isp || "Unknown",
      };
    }
  } catch (error) {
    console.error("Geo location error:", error);
  }
  return { country: "Unknown", city: "Unknown", ... };
}
```

#### 2.3. **ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ User-Agent**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° `ua-parser-js`:

```typescript
import { UAParser } from "ua-parser-js";

const parser = new UAParser(userAgent);
const uaResult = parser.getResult();

const visitorData = {
  device: uaResult.device.type || "desktop",
  browser: `${uaResult.browser.name} ${uaResult.browser.version}`,
  os: `${uaResult.os.name} ${uaResult.os.version}`,
  // ...
};
```

#### 2.4. **Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**

Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ² Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ JSON Ñ„Ğ°Ğ¹Ğ»:

```typescript
const dataDir = path.join(process.cwd(), "data");
const visitorsDataFile = path.join(dataDir, "visitors.json");

function saveData(data: unknown) {
  try {
    const existingData = getExistingData();
    existingData.push(data);
    fs.writeFileSync(visitorsDataFile, JSON.stringify(existingData, null, 2), "utf-8");
  } catch (error) {
    // ĞĞ° Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ read-only
    // Ğ­Ñ‚Ğ¾ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ - Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²ÑĞµ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ² Telegram
    console.warn("[SAVE] âš ï¸ Could not save to file:", error);
  }
}
```

#### 2.5. **ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Telegram**

```typescript
async function sendToTelegram(visitorData: {
  id: string;
  city: string;
  country: string;
  ip: string;
  device: string;
  os: string;
  browser: string;
  screen_resolution: string;
  referrer: string | null;
  utm_source: string | null;
  utm_medium?: string | null;
  utm_campaign: string | null;
  utm_term: string | null;
  utm_content?: string | null;
  page: string;
  timestamp: string;
  isFirstVisit?: boolean;
  metrikaData?: { ... } | null;
}) {
  const TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
  const TELEGRAM_CHAT_ID = process.env.TELEGRAM_CHAT_ID;

  if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
    console.error("[TELEGRAM] âŒ Telegram credentials not configured");
    return;
  }

  // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ...
  const message = `...`;

  const response = await fetch(
    `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message,
        parse_mode: "HTML",
      }),
    }
  );
}
```

**ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº POST:**

```typescript
export async function POST(request: NextRequest) {
  const requestId = Math.random().toString(36).substring(7);
  
  // 1. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
  const body = await request.json();
  const userAgent = request.headers.get("user-agent") || "";
  const ip = request.headers.get("x-forwarded-for")?.split(",")[0]?.trim() || 
             request.headers.get("x-real-ip") || "unknown";

  // 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ±Ğ¾Ñ‚Ğ°
  if (isBot(userAgent)) {
    return NextResponse.json({ tracked: false, reason: "bot", requestId });
  }

  // 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° IP
  if (!isValidIP(ip)) {
    return NextResponse.json({ tracked: false, reason: "invalid_ip", requestId });
  }

  // 4. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸
  const geoData = await getGeoLocation(ip);

  // 5. ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ User-Agent
  const parser = new UAParser(userAgent);
  const uaResult = parser.getResult();

  // 6. Ğ¡Ğ±Ğ¾Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ñ
  const visitorData = { /* ... */ };

  // 7. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Yandex.Metrika (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  const metrikaData = await getYandexMetrikaVisitorData(
    visitorData.referrer,
    visitorData.utm_source
  );

  // 8. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ñ„Ğ°Ğ¹Ğ»
  saveData(visitorData);

  // 9. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Telegram (Ğ¿Ñ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğ¸)
  await sendToTelegram({
    ...visitorData,
    isFirstVisit: body.isFirstVisit !== false,
    metrikaData,
  });

  return NextResponse.json({
    tracked: true,
    visitorId: visitorData.id,
    requestId,
  });
}
```

---

### 3. **Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Telegram**

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/telegram.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² Telegram Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹.

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**

#### 3.1. **sendToTelegram()**

Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:

```typescript
export async function sendToTelegram(
  message: string,
  chatId?: string
): Promise<{ success: boolean; error?: string }> {
  const botToken = process.env.TELEGRAM_BOT_TOKEN;
  const defaultChatId = process.env.TELEGRAM_CHAT_ID;
  const targetChatId = chatId || defaultChatId;

  if (!botToken || !targetChatId) {
    return { success: false, error: "Bot token or Chat ID not configured" };
  }

  const response = await fetch(
    `https://api.telegram.org/bot${botToken}/sendMessage`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: targetChatId,
        text: message,
        parse_mode: "HTML",
      }),
    }
  );

  const data = await response.json();
  return response.ok && data.ok
    ? { success: true }
    : { success: false, error: data.description || "Unknown error" };
}
```

#### 3.2. **formatContactMessage()**

Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾ Ğ·Ğ°ÑĞ²ĞºĞµ Ñ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹:

```typescript
export function formatContactMessage(data: {
  name: string;
  email: string;
  message: string;
  phone?: string;
}): string {
  return `
ğŸ†• <b>ĞĞ¾Ğ²Ğ°Ñ Ğ·Ğ°ÑĞ²ĞºĞ° Ñ ÑĞ°Ğ¹Ñ‚Ğ°!</b>

ğŸ‘¤ <b>Ğ˜Ğ¼Ñ:</b> ${escapeHtml(data.name)}
ğŸ“§ <b>Email:</b> ${escapeHtml(data.email)}
${data.phone ? `ğŸ“ <b>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</b> ${escapeHtml(data.phone)}\n` : ""}
ğŸ’¬ <b>Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:</b>
${escapeHtml(data.message)}

ğŸ“… Ğ”Ğ°Ñ‚Ğ°: ${new Date().toLocaleString("ru-RU", { timeZone: "Asia/Almaty" })}
  `.trim();
}
```

#### 3.3. **formatQuizMessage()**

Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ ĞºĞ²Ğ¸Ğ·Ğ°:

```typescript
export function formatQuizMessage(data: {
  name?: string;
  phone?: string;
  email?: string;
  answers: Record<string, unknown>;
  estimatedBudget?: string;
}): string {
  let message = "ğŸ¯ <b>ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ĞºĞ²Ğ¸Ğ·Ğ°!</b>\n\n";
  // ... Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² ...
  return message.trim();
}
```

#### 3.4. **escapeHtml()**

Ğ­ĞºÑ€Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ HTML Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸:

```typescript
function escapeHtml(text: string): string {
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
```

---

### 4. **API Routes Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼**

#### 4.1. **ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°**

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/contact/route.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² Telegram.

```typescript
export async function POST(request: NextRequest) {
  const body = await request.json();

  // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
  if (!body.name || !body.message) {
    return NextResponse.json({ error: "Ğ˜Ğ¼Ñ Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹" }, { status: 400 });
  }

  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ñ„Ğ°Ğ¹Ğ»
  const submission = {
    id: Date.now().toString(),
    ...body,
    type: "contact-form",
    submittedAt: new Date().toISOString(),
    ip: request.headers.get("x-forwarded-for") || "unknown",
    userAgent: request.headers.get("user-agent") || "unknown",
  };
  saveData(submission);

  // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Telegram
  const telegramMessage = formatContactMessage({
    name: body.name,
    email: body.email,
    phone: body.phone,
    message: body.message,
  });

  const telegramResult = await sendToTelegram(telegramMessage);

  return NextResponse.json({
    success: true,
    message: "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾",
    id: submission.id,
    telegramSent: telegramResult.success,
  });
}
```

#### 4.2. **ĞšĞ²Ğ¸Ğ·**

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/quiz/route.ts`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ĞºĞ²Ğ¸Ğ·Ğ° Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² Telegram.

ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğµ, Ğ½Ğ¾ Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² ĞºĞ²Ğ¸Ğ·Ğ°.

---

## ğŸ”— Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾ÑĞ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸

### Ğ¡Ñ…ĞµĞ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:

```
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚
   â†“
2. VisitorTracker (ĞºĞ»Ğ¸ĞµĞ½Ñ‚) ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:
   - sessionId (Ğ¸Ğ· sessionStorage Ğ¸Ğ»Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹)
   - UTM-Ğ¼ĞµÑ‚ĞºĞ¸ (Ğ¸Ğ· URL)
   - referrer (Ğ¸Ğ· document.referrer)
   - screenResolution (Ğ¸Ğ· window.screen)
   - landingPage (Ğ¸Ğ· sessionStorage Ğ¸Ğ»Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿ÑƒÑ‚ÑŒ)
   â†“
3. VisitorTracker Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ POST /api/track-visitor
   â†“
4. API Route Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ:
   a. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ½Ğ° Ğ±Ğ¾Ñ‚Ğ° (isBot)
   b. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ IP (isValidIP)
   c. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ (getGeoLocation)
   d. ĞŸĞ°Ñ€ÑĞ¸Ñ‚ User-Agent (UAParser)
   e. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ñ
   f. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Yandex.Metrika (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
   g. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² data/visitors.json (saveData)
   h. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Telegram (sendToTelegram)
   â†“
5. sendToTelegram Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Telegram Bot API
   â†“
6. Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Telegram Ñ‡Ğ°Ñ‚
```

### Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼Ğ¸:

```
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ñƒ (contact/quiz)
   â†“
2. Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ POST /api/contact Ğ¸Ğ»Ğ¸ /api/quiz
   â†“
3. API Route:
   a. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
   b. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² data/contact-submissions.json Ğ¸Ğ»Ğ¸ data/quiz-submissions.json
   c. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ (formatContactMessage / formatQuizMessage)
   d. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Telegram (sendToTelegram Ğ¸Ğ· lib/telegram.ts)
   â†“
4. Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Telegram Ñ‡Ğ°Ñ‚
```

---

## ğŸ› ï¸ Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸:

1. **Next.js 15.5.2** - React Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
2. **React** - UI Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
3. **TypeScript** - Ğ¢Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
4. **ua-parser-js** - ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ User-Agent
   ```bash
   npm install ua-parser-js
   ```
5. **uuid** - Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… ID
   ```bash
   npm install uuid
   ```
6. **ip-api.com** - Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ IP (Ğ±ĞµĞ· ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· fetch)

### Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:

1. **Telegram Bot API** - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
   - Endpoint: `https://api.telegram.org/bot{TOKEN}/sendMessage`
   - ĞœĞµÑ‚Ğ¾Ğ´: POST
   - Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: JSON

2. **ip-api.com** - Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ IP
   - Endpoint: `http://ip-api.com/json/{IP}?lang=ru`
   - ĞœĞµÑ‚Ğ¾Ğ´: GET
   - Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 45 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)

3. **Yandex.Metrika** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) - Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞµ
   - Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ OAuth Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸ Counter ID

---

## âš™ï¸ Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

### 1. **ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾/Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ñ**

**ĞĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ (visitor-tracker.tsx):**

```typescript
const isFirstVisit = !sessionStorage.getItem("visitor_tracked");
if (isFirstVisit) {
  sessionStorage.setItem("visitor_tracked", "true");
}
```

**ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ (route.ts):**

```typescript
function isNewVisitor(ip: string): boolean {
  if (ip === "unknown" || !ip) return true;
  const existingData = getExistingData();
  const hasVisitedBefore = existingData.some((v: { ip?: string }) => v.ip === ip);
  return !hasVisitedBefore;
}
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ **ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğ¸**, Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ Ğ¾Ñ‚ Ñ‚Ğ¾Ğ³Ğ¾, Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ ÑÑ‚Ğ¾ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ. Ğ¤Ğ»Ğ°Ğ³ `isFirstVisit` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸.

### 2. **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²**

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ User-Agent Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ±Ğ¾Ñ‚Ğ¾Ğ²:

```typescript
const BOT_USER_AGENTS = [
  "googlebot", "bingbot", "yandexbot", "baiduspider",
  "facebookexternalhit", "twitterbot", "linkedinbot",
  "slackbot", "discordbot", "whatsapp", "telegrambot",
  "crawl", "spider", "bot", "headless", "phantom",
  "selenium", "puppeteer", "playwright", "webdriver",
  "curl", "wget", "python-requests", "go-http-client", "java/"
];
```

**Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ:** ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ "http" Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ»Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ñ‹.

### 3. **Ğ¡Ğ±Ğ¾Ñ€ UTM-Ğ¼ĞµÑ‚Ğ¾Ğº**

UTM-Ğ¼ĞµÑ‚ĞºĞ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ÑÑ Ğ¸Ğ· URL Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğ¸ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ² `sessionStorage`:

```typescript
const urlParams = new URLSearchParams(window.location.search);
const utmData = {
  utmSource: urlParams.get("utm_source"),
  utmMedium: urlParams.get("utm_medium"),
  utmCampaign: urlParams.get("utm_campaign"),
  utmTerm: urlParams.get("utm_term"),
  utmContent: urlParams.get("utm_content"),
};

if (utmData.utmSource) {
  sessionStorage.setItem("utm_data", JSON.stringify(utmData));
}
```

Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ UTM-Ğ¼ĞµÑ‚ĞºĞ¸ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ† Ğ² ÑĞµÑÑĞ¸Ğ¸, Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° landing page.

### 4. **ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸**

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ `VisitorTracker` Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿ÑƒÑ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `usePathname()`:

```typescript
useEffect(() => {
  const timer = setTimeout(() => {
    trackVisitor();
  }, 100);
  return () => clearTimeout(timer);
}, [pathname]);
```

ĞŸÑ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑĞ¼ĞµĞ½Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ñ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ.

### 5. **ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº**

- **ĞÑˆĞ¸Ğ±ĞºĞ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ² Ñ„Ğ°Ğ¹Ğ»:** ĞĞµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ Ğ² Telegram (Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ read-only Ğ½Ğ° Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ…)
- **ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² Telegram:** Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ, Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- **ĞÑˆĞ¸Ğ±ĞºĞ¸ ÑĞµÑ‚Ğ¸:** ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ gracefully, Ğ½Ğµ Ğ²Ğ»Ğ¸ÑÑÑ‚ Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ ÑĞ°Ğ¹Ñ‚Ğ°

---

## ğŸ”§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### 1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Telegram Ğ±Ğ¾Ñ‚Ğ°**

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ [@BotFather](https://t.me/BotFather) Ğ² Telegram
2. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ `/newbot`
3. Ğ¡Ğ»ĞµĞ´ÑƒĞ¹Ñ‚Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸ÑĞ¼ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ°
4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. **ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Chat ID**

1. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµĞ¼Ñƒ Ğ±Ğ¾Ñ‚Ñƒ Ğ»ÑĞ±Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ `/start`)
2. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ: `https://api.telegram.org/bot<Ğ’ĞĞ¨_Ğ¢ĞĞšĞ•Ğ>/getUpdates`
3. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ `"chat":{"id":123456789}`
4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ ID

### 3. **ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `.env.local` Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=123456789

# ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Yandex.Metrika (Ğ´Ğ»Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞµ)
YANDEX_METRIKA_OAUTH_TOKEN=your_oauth_token
NEXT_PUBLIC_YM_ID=your_counter_id

# ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Google Analytics
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX

# ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: URL ÑĞ°Ğ¹Ñ‚Ğ° (Ğ´Ğ»Ñ Yandex.Metrika API)
NEXT_PUBLIC_SITE_URL=https://your-site.com
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ¤Ğ°Ğ¹Ğ» `.env.local` Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ² Git (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² `.gitignore`).

### 4. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ endpoint Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:

```bash
curl http://localhost:3000/api/track-visitor/test
```

Ğ˜Ğ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ: `http://localhost:3000/api/track-visitor/test`

ĞÑ‚Ğ²ĞµÑ‚ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ:
```json
{
  "telegramConfigured": true,
  "hasToken": true,
  "hasChatId": true
}
```

---

## ğŸ“¨ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ğµ

```
ğŸ†• ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ!

ğŸ‘¤ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:
ğŸ“ ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹, ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½
ğŸŒ IP: 123.45.67.89

ğŸ’» Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾:
ğŸ“± ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ
ğŸ–¥ï¸ ĞĞ¡: iOS 17.0
ğŸŒ Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€: Chrome 120.0
ğŸ“± Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: 1920x1080

ğŸ”— Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°:
ğŸ’° ĞŸĞ»Ğ°Ñ‚Ğ½Ğ°Ñ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ°
ğŸ“Š Source: yandex
ğŸ“¢ Medium: cpc
ğŸ“‹ Campaign: summer2024
ğŸ”‘ Term: Ñ‚Ğ°Ñ€Ğ³ĞµÑ‚Ğ¾Ğ»Ğ¾Ğ³ Ğ°Ğ»Ğ¼Ğ°Ñ‚Ñ‹
ğŸ“ Content: banner_1

ğŸ“„ ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ:
ğŸ“– Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°: /ru
â± Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ°: 21.11.2025, 03:55:00
```

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğµ

```
ğŸ”„ ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ²Ğ¸Ğ·Ğ¸Ñ‚

ğŸ‘¤ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:
ğŸ“ ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹, ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½
ğŸŒ IP: 123.45.67.89

ğŸ’» Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾:
ğŸ–¥ï¸ Ğ”ĞµÑĞºÑ‚Ğ¾Ğ¿
ğŸ–¥ï¸ ĞĞ¡: Windows 11
ğŸŒ Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€: Chrome 120.0
ğŸ“± Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: 1920x1080

ğŸ”— Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°:
ğŸŒ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ·Ğ°Ñ…Ğ¾Ğ´ / Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ
ğŸ”— ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ·Ğ°Ñ…Ğ¾Ğ´

ğŸ“„ ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ:
ğŸ“– Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°: /ru/services
â± Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ°: 21.11.2025, 04:10:00

ğŸ”„ Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ² ÑÑ‚Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸
```

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ·Ğ°ÑĞ²ĞºĞµ Ñ Ñ„Ğ¾Ñ€Ğ¼Ñ‹

```
ğŸ†• ĞĞ¾Ğ²Ğ°Ñ Ğ·Ğ°ÑĞ²ĞºĞ° Ñ ÑĞ°Ğ¹Ñ‚Ğ°!

ğŸ‘¤ Ğ˜Ğ¼Ñ: Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²
ğŸ“§ Email: ivan@example.com
ğŸ“ Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½: +7 777 123 45 67

ğŸ’¬ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:
Ğ¥Ğ¾Ñ‡Ñƒ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ ÑĞ°Ğ¹Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ°.

ğŸ“… Ğ”Ğ°Ñ‚Ğ°: 21.11.2025, 04:15:00
```

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ ĞºĞ²Ğ¸Ğ·Ğ°

```
ğŸ¯ ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ĞºĞ²Ğ¸Ğ·Ğ°!

ğŸ‘¤ Ğ˜Ğ¼Ñ: ĞœĞ°Ñ€Ğ¸Ñ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²Ğ°
ğŸ“ Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½: +7 777 123 45 67
ğŸ“§ Email: maria@example.com

ĞÑ‚Ğ²ĞµÑ‚Ñ‹:
â€¢ Ğ¦ĞµĞ»ÑŒ: Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ°Ğ¹Ñ‚Ğ°
â€¢ ĞĞ¸ÑˆĞ°: Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚-Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½
â€¢ Ğ‘ÑĞ´Ğ¶ĞµÑ‚: 500 000 - 1 000 000 â‚¸
â€¢ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹: Web, Mobile

ğŸ’° ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ±ÑĞ´Ğ¶ĞµÑ‚: 500 000 - 1 000 000 â‚¸

ğŸ“… Ğ”Ğ°Ñ‚Ğ°: 21.11.2025, 04:20:00
```

---

## ğŸ’¡ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### 1. **ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞºĞ¾Ğ² Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸**

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ĞºĞ»Ğ¸ĞºĞ¸ Ğ½Ğ° CTA-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸:

```typescript
// Ğ’ visitor-tracker.tsx
const handleClick = (e: MouseEvent) => {
  const button = target.closest('button, a[href*="#"], a[href*="tel:"], a[href*="mailto:"]');
  if (button && window.visitorTracker) {
    const isCTA = buttonText.toLowerCase().includes("Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ") || 
                  buttonText.toLowerCase().includes("ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ");
    if (isCTA) {
      window.visitorTracker.trackClick(buttonText, buttonType);
    }
  }
};
```

### 2. **ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¹**

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ„Ğ¾Ñ€Ğ¼:

```typescript
const handleSubmit = (e: Event) => {
  const form = e.target as HTMLFormElement;
  if (window.visitorTracker && form) {
    window.visitorTracker.trackConversion(`form_${form.id}`, {
      formId: form.id,
      formClass: form.className,
    });
  }
};
```

### 3. **Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹**

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ `window.visitorTracker`:

```typescript
// ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞºĞ°
window.visitorTracker?.trackClick("ĞšĞ½Ğ¾Ğ¿ĞºĞ° 'Ğ—Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ'", "button");

// ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¸
window.visitorTracker?.trackConversion("phone_call", {
  phone: "+7 777 123 45 67",
});

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ
window.visitorTracker?.updateBehavior({
  timeOnSite: 120,
  clicks: 5,
  conversions: ["form_submit", "phone_call"],
});
```

### 4. **Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¾Ğ¹**

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ² Yandex.Metrika Ğ¸ Google Analytics:

```typescript
// Yandex.Metrika
if (typeof window.ym !== "undefined" && ymId) {
  window.ym(ymId, "reachGoal", "visitor_tracked", {
    visitor_id: data.visitorId,
  });
}

// Google Analytics
if (typeof window.gtag !== "undefined") {
  window.gtag("event", "visitor_tracked", {
    visitor_id: data.visitorId,
  });
}
```

---

## ğŸ” Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°

### 1. **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°Ğ¼Ğ¸:

- `[VISITOR-TRACKER]` - ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ
- `[TRACK-xxx]` - Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ (xxx - ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°)
- `[TELEGRAM]` - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Telegram
- `[SAVE]` - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- `[CONTACT]` - ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
- `[QUIZ]` - ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ²Ğ¸Ğ·Ğ°

### 2. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹**

#### Ğ¨Ğ°Ğ³ 1: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

```bash
curl http://localhost:3000/api/track-visitor/test
```

#### Ğ¨Ğ°Ğ³ 2: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```bash
cat data/visitors.json
```

#### Ğ¨Ğ°Ğ³ 3: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ DevTools (F12) â†’ Console, Ğ¸Ñ‰Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ¾Ğ¼ `[VISITOR-TRACKER]`.

#### Ğ¨Ğ°Ğ³ 4: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ

Ğ’ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğµ, Ğ³Ğ´Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ `npm run dev`, Ğ¸Ñ‰Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°Ğ¼Ğ¸ `[TRACK-xxx]`, `[TELEGRAM]`.

### 3. **Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹**

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´ÑÑ‚

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ: `TELEGRAM_BOT_TOKEN` Ğ¸ `TELEGRAM_CHAT_ID`
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ: `[TELEGRAM] âŒ`
3. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ±Ğ¾Ñ‚ Ğ½Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Chat ID Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿)

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ‘Ğ¾Ñ‚Ñ‹ Ğ½Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒÑÑ‚ÑÑ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ User-Agent Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…: `[TRACK-xxx] User-Agent: ...`
2. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ±Ğ¾Ñ‚Ğ° Ğ² `BOT_USER_AGENTS` Ğ² `route.ts`

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: IP Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ "unknown"

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ­Ñ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞºÑĞ¸/CDN
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµÑ‚ "unknown" IP Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¿Ñ€Ğ¾ĞºÑĞ¸
- Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ±ÑƒĞ´ĞµÑ‚ "Unknown" Ğ´Ğ»Ñ Ñ‚Ğ°ĞºĞ¸Ñ… IP

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: UTM-Ğ¼ĞµÑ‚ĞºĞ¸ Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ UTM-Ğ¼ĞµÑ‚ĞºĞ¸ ĞµÑÑ‚ÑŒ Ğ² URL: `?utm_source=yandex&utm_medium=cpc`
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ `sessionStorage` Ğ² DevTools: `sessionStorage.getItem("utm_data")`
3. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ UTM-Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ğ² POST Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Network tab)

### 4. **Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:

```bash
npx tsx scripts/test-visitor-tracking.ts
```

Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²ÑĞµ ÑÑ‚Ğ°Ğ¿Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.

---

## ğŸ“Š Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ñ (visitorData)

```typescript
{
  id: string;                    // UUID
  ip: string;                     // IP-Ğ°Ğ´Ñ€ĞµÑ
  user_agent: string;             // User-Agent Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
  
  // Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
  country: string;                // Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ°
  city: string;                   // Ğ“Ğ¾Ñ€Ğ¾Ğ´
  region: string;                 // Ğ ĞµĞ³Ğ¸Ğ¾Ğ½
  timezone: string;               // Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ
  isp: string;                    // ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€
  
  // Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾
  device: string;                 // "mobile" | "tablet" | "desktop"
  browser: string;                // "Chrome 120.0"
  os: string;                     // "Windows 11"
  screen_resolution: string;      // "1920x1080"
  
  // Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
  referrer: string | null;        // Referrer URL
  utm_source: string | null;      // UTM Source
  utm_medium: string | null;      // UTM Medium
  utm_campaign: string | null;    // UTM Campaign
  utm_term: string | null;        // UTM Term
  utm_content: string | null;    // UTM Content
  
  // ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
  page: string;                   // Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°
  landing_page: string;           // ĞŸĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ² ÑĞµÑÑĞ¸Ğ¸
  timeOnSite: number;             // Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ (ÑĞµĞºÑƒĞ½Ğ´Ñ‹)
  clicks: number;                 // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ»Ğ¸ĞºĞ¾Ğ²
  conversions: string[];          // ĞœĞ°ÑÑĞ¸Ğ² ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¹
  pagesViewed: number;            // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
  clickEvents: Array<{            // Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ĞºĞ»Ğ¸ĞºĞ¾Ğ²
    element: string;
    type: string;
    timestamp: string;
  }>;
  conversionEvents: Array<{       // Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¹
    type: string;
    data: Record<string, unknown>;
    timestamp: string;
  }>;
  
  timestamp: string;              // ISO timestamp
  session_id: string | null;      // Session ID
}
```

### Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ (contact/quiz)

```typescript
{
  id: string;                     // Timestamp ID
  name: string;                  // Ğ˜Ğ¼Ñ
  email?: string;                // Email (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  phone?: string;                // Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  message?: string;              // Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ (Ğ´Ğ»Ñ contact)
  answers?: Record<string, unknown>; // ĞÑ‚Ğ²ĞµÑ‚Ñ‹ (Ğ´Ğ»Ñ quiz)
  type: string;                  // "contact-form" | "quiz"
  submittedAt: string;           // ISO timestamp
  ip: string;                    // IP-Ğ°Ğ´Ñ€ĞµÑ
  userAgent: string;             // User-Agent
}
```

---

## ğŸ“ Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² Telegram Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ±Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»ĞµĞ¹ Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼:

- âœ… ĞĞ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸ (Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº, fallback Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ñ‹)
- âœ… ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
- âœ… Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ², Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
- âœ… Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚Ğ¸ (Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹)
- âœ… Ğ£Ğ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°)

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² production Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ»ĞµĞ³ĞºĞ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹.

---

**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 2025-11-21  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**ĞĞ²Ñ‚Ğ¾Ñ€:** AI Assistant (Auto)

