# üîç –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Å–µ—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π —Å–∞–π—Ç–∞, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –±–æ—Ç–æ–≤, —Å–æ–±–∏—Ä–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram.

## –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

### –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
- ‚úÖ IP-–∞–¥—Ä–µ—Å
- ‚úÖ –°—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥ (–ø–æ IP)
- ‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (Desktop/Mobile/Tablet)
- ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∏ –≤–µ—Ä—Å–∏—è
- ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞

### –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞:
- ‚úÖ –û—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª (UTM-–º–µ—Ç–∫–∏, referrer)
- ‚úÖ –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ –†–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è (UTM-–º–µ—Ç–∫–∏)

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
- ‚úÖ –ü–æ—Å–µ—â—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ Landing page (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Å–µ—Å—Å–∏–∏)
- ‚úÖ Session ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤:
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ—Ç–æ–≤ –ø–æ User-Agent
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–æ—Ç–æ–≤ (Google Bot, Yandex Bot, etc.)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. –ü–æ–ª—É—á–∏—Ç–µ Chat ID

1. –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ–º—É –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä `/start`)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.telegram.org/bot<–í–ê–®_–¢–û–ö–ï–ù>/getUpdates`
3. –ù–∞–π–¥–∏—Ç–µ –≤ –æ—Ç–≤–µ—Ç–µ `"chat":{"id":123456789}`
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç ID

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=123456789

# Google Analytics 4 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX

# Yandex.Metrika (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
NEXT_PUBLIC_YM_ID=12345678
```

**–í–∞–∂–Ω–æ:** –§–∞–π–ª `.env.local` —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` –∏ –Ω–µ –±—É–¥–µ—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ Git.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. ‚úÖ –ö–∞–∂–¥—ã–π —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. ‚úÖ –ë–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram
3. ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data/visitors.json`
4. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìä –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

```
üîî –ù–æ–≤—ã–π –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –Ω–∞ —Å–∞–π—Ç–µ!

üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –ê–ª–º–∞—Ç—ã, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
üåê IP: 178.89.123.45
üíª –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: mobile (iOS 17.0)
üåç –ë—Ä–∞—É–∑–µ—Ä: Safari 17.0
üì± –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 390x844

üîó –ò—Å—Ç–æ—á–Ω–∏–∫:
üìä –û—Ç–∫—É–¥–∞: google.com
üîé UTM Source: google
üì¢ UTM Campaign: target_almaty_nov

üìÑ –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
üìñ –°—Ç—Ä–∞–Ω–∏—Ü–∞: /almaty/targetirovannaya-reklama
‚è± –í—Ä–µ–º—è –≤–∏–∑–∏—Ç–∞: 20.11.2025 09:15:32
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data/visitors.json`:

```json
[
  {
    "id": "uuid",
    "ip": "178.89.123.45",
    "user_agent": "...",
    "country": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",
    "city": "–ê–ª–º–∞—Ç—ã",
    "region": "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
    "timezone": "Asia/Almaty",
    "isp": "Kazakhtelecom",
    "device": "mobile",
    "browser": "Safari 17.0",
    "os": "iOS 17.0",
    "screen_resolution": "390x844",
    "referrer": "https://google.com",
    "utm_source": "google",
    "utm_campaign": "target_almaty_nov",
    "page": "/almaty/targetirovannaya-reklama",
    "landing_page": "/",
    "timestamp": "2025-11-20T09:15:32.000Z",
    "session_id": "uuid"
  }
]
```

## üîß API Endpoints

### POST `/api/track-visitor`

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è.

**Request Body:**
```json
{
  "page": "/almaty/targetirovannaya-reklama",
  "landingPage": "/",
  "referrer": "https://google.com",
  "screenResolution": "390x844",
  "sessionId": "uuid",
  "utmSource": "google",
  "utmCampaign": "target_almaty_nov"
}
```

**Response:**
```json
{
  "tracked": true,
  "visitorId": "uuid"
}
```

### GET `/api/track-visitor`

–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π.

**Response:**
```json
{
  "success": true,
  "count": 150,
  "visitors": [...]
}
```

## üö´ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –±–æ—Ç–æ–≤:

- –ü–æ–∏—Å–∫–æ–≤—ã–µ –±–æ—Ç—ã: Googlebot, Bingbot, Yandexbot, Baiduspider
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏: Facebook, Twitter, LinkedIn, Slack, Discord, WhatsApp, Telegram
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: Selenium, Puppeteer, Playwright, Headless Chrome
- –°–∫–∞–Ω–µ—Ä—ã: curl, wget, python-requests, go-http-client

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤:

- **Yandex.Metrika**: —Å–æ–±—ã—Ç–∏–µ `visitor_tracked` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- **Google Analytics 4**: —Å–æ–±—ã—Ç–∏–µ `visitor_tracked` —Å visitor_id

## üìà –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Supabase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Supabase –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–∞:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com)
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `visitors` (—Å–º. SQL –Ω–∏–∂–µ)
3. –û–±–Ω–æ–≤–∏—Ç–µ `.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJxxx...
```

4. –û–±–Ω–æ–≤–∏—Ç–µ `app/api/track-visitor/route.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–∞

### SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE visitors (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ip VARCHAR(45),
  user_agent TEXT,
  country VARCHAR(100),
  city VARCHAR(100),
  region VARCHAR(100),
  timezone VARCHAR(50),
  isp VARCHAR(255),
  device VARCHAR(50),
  browser VARCHAR(100),
  os VARCHAR(100),
  screen_resolution VARCHAR(20),
  referrer TEXT,
  utm_source VARCHAR(100),
  utm_medium VARCHAR(100),
  utm_campaign VARCHAR(100),
  utm_term VARCHAR(255),
  utm_content VARCHAR(255),
  page VARCHAR(500),
  landing_page VARCHAR(500),
  timestamp TIMESTAMPTZ DEFAULT NOW(),
  session_id UUID,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_visitors_ip ON visitors(ip);
CREATE INDEX idx_visitors_session ON visitors(session_id);
CREATE INDEX idx_visitors_timestamp ON visitors(timestamp DESC);
CREATE INDEX idx_visitors_utm_source ON visitors(utm_source);
```

## üõ†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫

–ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞—è–≤–æ–∫ –∏–∑ —Ñ–æ—Ä–º:

```typescript
// –í API route —Ñ–æ—Ä–º—ã
await sendToTelegram({
  type: 'lead',
  name: formData.name,
  phone: formData.phone,
  source: 'contact_form',
  page: formData.page,
});
```

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å cron-–∑–∞–¥–∞—á—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤:

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ node-cron –∏–ª–∏ Vercel Cron
// –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –¥–µ–Ω—å –≤ Telegram
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –°–æ–∑–¥–∞–Ω Telegram –±–æ—Ç —á–µ—Ä–µ–∑ @BotFather
- [ ] –ü–æ–ª—É—á–µ–Ω Chat ID
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω `.env.local` —Å —Ç–æ–∫–µ–Ω–∞–º–∏
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã (–æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤ (–±–æ—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env.local` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git)
- ‚úÖ IP-–∞–¥—Ä–µ—Å–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
- ‚úÖ –ë–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–∏–ª–∏ –≤ Supabase)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Telegram –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ Chat ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–∞–∂–¥–æ–º —Ä–µ–∞–ª—å–Ω–æ–º –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ —Å–∞–π—Ç–∞ –≤ Telegram! üöÄ

